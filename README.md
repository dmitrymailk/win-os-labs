# Лабораторная 6 – Динамические библиотеки.

### О работе с динамическими библиотеками можно почитать, например, здесь:

### методичка В.А. Клячина http://citforum.ru/book/cook/dll0.shtml http://www.helloworld.ru/texts/comp/lang/visualc/vc2/12.htm http://frolov-lib.ru/books/bsp/v27/ch3_3.htm

## Задание 1 – Неявное связывание. (10 баллов)

- Поместите функции потоков из лабораторной работы №5 в динамическую библиотеку (DLL). Осуществите не-явное связывание Вашего многопоточного приложения с динамической библиотекой. В результате Ваша про-грамма должна работать так же, как и раньше, но функции потоков будут взяты из динамической библиотеки.

## Рекомендации:
  1. Прежде, чем приступать к непосредственному решению задачи, рекомендуется создать динамиче-скую библиотеку с простейшей функцией, например, выводящей на экран какую-нибудь фиксирован-ную фразу. А также написать простую программу, использующую эту функцию из Вашей библиотеки (неявно).

  2. Для создания dll-библиотеки в Visual Studio необходимо выбрать «Создание консольного приложе-ния», а затем в окне выбора параметров указать «Библиотека DLL».

  3. В созданном проекте уже будут необходимые Вам файлы (в том числе и dllmain), останется добавить заголовочный (.h) файл. Это можно сделать в Обозревателе решений щелчком правой кнопки мыши по строке Заголовочные файлы - Добавить - Создать элемент. Не забудьте подключить этот заголовоч-ный файл в .cpp файле.

  4. После компиляции Вы получите файлы dll, lib, которые, вместе с заголовочным файлом, понадобятся для использования dll-библиотеки в вашей программе (их нужно скопировать в папку с вашим прило-жением).

  5. Помните, что при неявном связывании файл .lib необходимо подключить к проекту, использующему dll-библиотеку (Свойства проекта – Компоновщик – Ввод – Дополнительные зависимости).

## Задание 2 – Явное связывание. (10 баллов)

- Поместите функции потоков из лабораторной работы №5 в динамическую библиотеку (DLL). Осуществите яв-ное связывание Вашего многопоточного приложения с динамической библиотекой используя функции LoadLibrary(), GetProcAddress() и FreeLibrary(). В результате Ваша программа должна работать так же, как и раньше, но функции потоков будут взяты из динамической библиотеки, подключенной явно.

### Рекомендации:

  - Обратите внимание на искажение имен функций dll-библиотеки (мангл), которое может вызвать трудности при явном ее использовании (это описывается, например, здесь http://citforum.ru/book/cook/dll0.shtml).

  - Для запрета изменения имен можно добавить def файл с соответствующими инструкциями (Обозреватель решений - Файлы исходного кода – Добавить элемент). Если Вы решите не использовать def файл, то преоб-разованные имена функций можно увидеть в exp файле (exports library file) после компиляции dll-библиотеки, и именно их нужно будет передавать в качестве аргумента функции GetProcAddress. (Например, функция с названием MyThread может получить имя _MyThread@4)

  - О том, какой тип связывания обычно используют для решения конкретной задачи, можно прочитать, напри-мер, здесь: http://msdn.microsoft.com/ru-ru/library/253b8k2c(v=vs.90).aspx.